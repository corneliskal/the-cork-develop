<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Cork - Wine Cellar</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <img src="logo.png" alt="The Cork" class="logo-icon">
                </div>
                <button id="settingsBtn" class="settings-btn" aria-label="Settings">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                </button>
                <div class="header-stats">
                    <span id="totalBottles">0</span> bottles
                </div>
                <div id="syncStatus" class="sync-status">
                    <span class="status-local">ðŸ’¾ Lokaal</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Search Bar -->
            <div id="searchContainer" class="search-container hidden">
                <div class="search-input-wrapper">
                    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="M21 21l-4.35-4.35"/>
                    </svg>
                    <input type="text" id="searchInput" class="search-input" placeholder="Search wine, producer, grape...">
                    <button id="clearSearch" class="clear-search-btn hidden">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div id="searchResults" class="search-results hidden">
                    <span id="searchResultCount">0 results</span>
                </div>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state">
                <div class="empty-illustration">
                    <img src="logo.png" alt="The Cork" class="empty-logo">
                </div>
                <h2>Your cellar is empty</h2>
                <p>Tap + to add your first bottle</p>
            </div>

            <!-- Wine List -->
            <div id="wineList" class="wine-list"></div>
        </main>

        <!-- Add Button -->
        <button id="addWineBtn" class="fab" aria-label="Add wine">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        </button>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal">
            <div class="modal-content settings-modal">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button class="close-btn" data-close="settingsModal">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="settings-section">
                        <h3>OpenAI API Key</h3>
                        <p class="settings-description">Add your API key to enable AI-powered wine label recognition. Get your key from <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com</a></p>

                        <div class="api-key-status" id="apiKeyStatus">
                            <span class="status-disconnected">Not configured</span>
                        </div>

                        <div class="api-key-input-group">
                            <input type="text" id="apiKeyInput" placeholder="sk-..." class="api-key-input">
                            <button id="saveApiKey" class="save-key-btn">Save</button>
                        </div>

                        <button id="clearApiKey" class="clear-key-btn">Clear API Key</button>
                    </div>

                    <div class="settings-section">
                        <h3>Google Image Search (optioneel)</h3>
                        <p class="settings-description">
                            Voor automatische productfoto's heb je een Google Custom Search API nodig.<br><br>
                            1. Ga naar <a href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Cloud Console</a> en maak een API key<br>
                            2. Ga naar <a href="https://programmablesearchengine.google.com/" target="_blank">Programmable Search Engine</a> en maak een zoekmachine (zet "Image search" aan)<br>
                            3. Kopieer de Search Engine ID (cx)
                        </p>

                        <div class="api-key-status" id="googleKeyStatus">
                            <span class="status-disconnected">Niet geconfigureerd - Je eigen foto wordt gebruikt</span>
                        </div>

                        <div class="form-group" style="margin-bottom: 12px;">
                            <label for="googleApiKeyInput" style="font-size: 13px; color: #666;">Google API Key</label>
                            <input type="text" id="googleApiKeyInput" placeholder="AIza..." class="api-key-input">
                        </div>

                        <div class="form-group" style="margin-bottom: 12px;">
                            <label for="googleCxInput" style="font-size: 13px; color: #666;">Search Engine ID (cx)</label>
                            <input type="text" id="googleCxInput" placeholder="a1b2c3..." class="api-key-input">
                        </div>

                        <div class="api-key-input-group">
                            <button id="saveGoogleKeys" class="save-key-btn" style="flex: 1;">Opslaan</button>
                        </div>

                        <button id="clearGoogleKeys" class="clear-key-btn">Google Keys Verwijderen</button>
                    </div>

                    <div class="settings-section" id="authSection">
                        <h3>Cloud Sync (Firebase)</h3>
                        <p class="settings-description">
                            Synchroniseer je wijnkelder tussen al je apparaten.<br>
                            Log in met je Google account om je wijnen overal te zien.
                        </p>

                        <div class="api-key-status" id="userInfo" style="display: none; color: var(--system-green);">
                        </div>

                        <button id="googleSignInBtn" class="google-sign-in-btn">
                            <svg viewBox="0 0 24 24" width="18" height="18">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            Inloggen met Google
                        </button>

                        <button id="signOutBtn" class="clear-key-btn" style="display: none;">
                            Uitloggen
                        </button>

                        <div class="api-key-status" id="firebaseSyncStatus" style="margin-top: 12px;">
                            <span class="status-disconnected">Niet ingelogd</span>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>About</h3>
                        <p class="settings-description">The Cork uses GPT-4 Vision to read wine labels and automatically fetch wine characteristics, tasting notes, and pricing information.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Wine Modal -->
        <div id="addModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Add Wine</h2>
                    <button class="close-btn" data-close="addModal">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>

                <div class="modal-body">
                    <!-- Image Upload Section -->
                    <div class="upload-section">
                        <div id="imagePreview" class="image-preview">
                            <div class="upload-placeholder">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                    <path d="M21 15l-5-5L5 21"/>
                                </svg>
                                <span>Tap to add photo</span>
                            </div>
                            <img id="previewImg" src="" alt="Wine label preview">
                        </div>
                        <div class="upload-buttons">
                            <button id="cameraBtn" class="upload-btn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                    <circle cx="12" cy="13" r="4"/>
                                </svg>
                                Camera
                            </button>
                            <button id="galleryBtn" class="upload-btn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                    <path d="M21 15l-5-5L5 21"/>
                                </svg>
                                Gallery
                            </button>
                        </div>
                        <input type="file" id="cameraInput" accept="image/*" capture="environment" hidden>
                        <input type="file" id="galleryInput" accept="image/*" hidden>
                    </div>

                    <!-- Scanning Indicator -->
                    <div id="scanningIndicator" class="scanning-indicator hidden">
                        <div class="scanning-animation">
                            <div class="scan-line"></div>
                        </div>
                        <p>Reading label...</p>
                    </div>

                    <!-- Wine Form -->
                    <form id="wineForm" class="wine-form">
                        <div class="form-group">
                            <label for="wineName">Wine Name *</label>
                            <input type="text" id="wineName" required placeholder="e.g., Grand Vin 2015">
                        </div>

                        <div class="form-group">
                            <label for="wineProducer">Producer / House</label>
                            <input type="text" id="wineProducer" placeholder="e.g., ChÃ¢teau Margaux">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="wineType">Type</label>
                                <select id="wineType">
                                    <option value="red">Red</option>
                                    <option value="white">White</option>
                                    <option value="rosÃ©">RosÃ©</option>
                                    <option value="sparkling">Sparkling</option>
                                    <option value="dessert">Dessert</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="wineYear">Year</label>
                                <input type="number" id="wineYear" min="1900" max="2030" placeholder="2020">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="wineRegion">Region</label>
                            <input type="text" id="wineRegion" placeholder="e.g., Bordeaux, France">
                        </div>

                        <div class="form-group">
                            <label for="wineGrape">Grape Variety</label>
                            <input type="text" id="wineGrape" placeholder="e.g., Cabernet Sauvignon">
                        </div>

                        <div class="characteristics-section">
                            <h3>Characteristics</h3>

                            <div class="characteristic-slider">
                                <label>
                                    <span>Boldness</span>
                                    <span class="char-value" id="boldnessValue">3</span>
                                </label>
                                <input type="range" id="boldness" min="1" max="5" value="3">
                                <div class="slider-labels">
                                    <span>Light</span>
                                    <span>Bold</span>
                                </div>
                            </div>

                            <div class="characteristic-slider">
                                <label>
                                    <span>Tannins</span>
                                    <span class="char-value" id="tanninsValue">3</span>
                                </label>
                                <input type="range" id="tannins" min="1" max="5" value="3">
                                <div class="slider-labels">
                                    <span>Smooth</span>
                                    <span>Tannic</span>
                                </div>
                            </div>

                            <div class="characteristic-slider">
                                <label>
                                    <span>Acidity</span>
                                    <span class="char-value" id="acidityValue">3</span>
                                </label>
                                <input type="range" id="acidity" min="1" max="5" value="3">
                                <div class="slider-labels">
                                    <span>Soft</span>
                                    <span>Acidic</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="winePrice">Prijs (â‚¬)</label>
                                <input type="number" id="winePrice" min="0" step="0.01" placeholder="25.00">
                            </div>
                            <div class="form-group">
                                <label for="wineQuantity">Aantal</label>
                                <div class="quantity-control">
                                    <button type="button" class="qty-btn" data-action="decrease">âˆ’</button>
                                    <input type="number" id="wineQuantity" min="1" value="1">
                                    <button type="button" class="qty-btn" data-action="increase">+</button>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="wineStore">Winkel</label>
                            <input type="text" id="wineStore" placeholder="bijv. Albert Heijn, Gall & Gall">
                        </div>

                        <div class="form-group">
                            <label for="wineNotes">Tasting Notes</label>
                            <textarea id="wineNotes" rows="3" placeholder="Your personal notes..."></textarea>
                        </div>

                        <button type="submit" class="submit-btn">Add to Cellar</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Wine Detail Modal -->
        <div id="detailModal" class="modal">
            <div class="modal-content detail-modal">
                <button class="close-btn detail-close" data-close="detailModal">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>

                <div class="detail-header">
                    <div id="detailImage" class="detail-image">
                        <div class="wine-type-badge" id="detailTypeBadge">Red</div>
                    </div>
                </div>

                <div class="detail-body">
                    <div class="detail-title-section">
                        <h2 id="detailName">Wine Name</h2>
                        <p id="detailProducer" class="detail-producer">Producer</p>
                        <p id="detailRegion" class="detail-region">Region, Country</p>
                    </div>

                    <div class="detail-meta">
                        <div class="meta-item">
                            <span class="meta-label">Jaar</span>
                            <span id="detailYear" class="meta-value">2020</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Druif</span>
                            <span id="detailGrape" class="meta-value">Cabernet</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Prijs</span>
                            <span id="detailPrice" class="meta-value">â‚¬25</span>
                        </div>
                    </div>

                    <div id="detailStoreSection" class="detail-store">
                        <span class="store-icon">ðŸ›’</span>
                        <span id="detailStore">Winkel</span>
                    </div>

                    <div class="detail-characteristics">
                        <h3>Profile</h3>
                        <div class="char-bars">
                            <div class="char-bar-item">
                                <span class="char-label">Boldness</span>
                                <div class="char-bar">
                                    <div id="detailBoldness" class="char-fill" style="width: 60%"></div>
                                </div>
                            </div>
                            <div class="char-bar-item">
                                <span class="char-label">Tannins</span>
                                <div class="char-bar">
                                    <div id="detailTannins" class="char-fill" style="width: 60%"></div>
                                </div>
                            </div>
                            <div class="char-bar-item">
                                <span class="char-label">Acidity</span>
                                <div class="char-bar">
                                    <div id="detailAcidity" class="char-fill" style="width: 60%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="detailNotesSection" class="detail-notes">
                        <h3>Notes</h3>
                        <p id="detailNotes"></p>
                    </div>

                    <div class="detail-quantity-section">
                        <h3>In Cellar</h3>
                        <div class="detail-quantity-control">
                            <button class="qty-btn large" id="detailDecrease">âˆ’</button>
                            <span id="detailQuantity" class="detail-qty-value">1</span>
                            <button class="qty-btn large" id="detailIncrease">+</button>
                        </div>
                        <span class="bottles-label">bottles</span>
                    </div>

                    <div class="detail-actions">
                        <button id="editWineBtn" class="action-btn edit-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                            Edit
                        </button>
                        <button id="deleteWineBtn" class="action-btn delete-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                            Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div id="deleteModal" class="modal">
            <div class="modal-content delete-modal">
                <div class="delete-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="15" y1="9" x2="9" y2="15"/>
                        <line x1="9" y1="9" x2="15" y2="15"/>
                    </svg>
                </div>
                <h3>Remove Wine?</h3>
                <p>This will permanently remove <strong id="deleteWineName"></strong> from your cellar.</p>
                <div class="delete-actions">
                    <button class="cancel-btn" data-close="deleteModal">Cancel</button>
                    <button id="confirmDelete" class="confirm-delete-btn">Remove</button>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="toast">
            <span id="toastMessage"></span>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script src="config.js"></script>
    <script src="app.js"></script>
</body>
</html>
